<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload</title>
    <link rel="stylesheet" href="../upload_vid_files/style.css">
    <link href="../../main_css/main_body_css/img/favicon.png" rel="icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

    <!-- Bootstrap CSS File -->
    <link href="../../main_css/nav_bar_css/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Libraries CSS Files -->
    <link href="../../main_css/nav_bar_css/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../main_css/nav_bar_css/lib/animate/animate.min.css" rel="stylesheet">
    <link href="../../main_css/nav_bar_css/lib/ionicons/css/ionicons.min.css" rel="stylesheet">

    <!-- Main Stylesheet File -->
    <link href="../../main_css/nav_bar_css/css/style.css" rel="stylesheet">
    <link href="../../register_css/register_style.css" rel="stylesheet">
</head>

<body>
    <!-- Nav bar -->
    <!--/ Nav Start /-->
    <nav class="navbar navbar-default navbar-trans navbar-expand-lg fixed-top">
        <div class="container">
            <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarDefault"
                aria-controls="navbarDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <a class="navbar-brand text-brand" href="/">Block<span class="color-b">Chain</span></a>
            <button type="button" class="btn btn-link nav-search navbar-toggle-box-collapse d-md-none"
                data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-expanded="false">
                <span class="fa fa-search" aria-hidden="true"></span>
            </button>
            <div class="navbar-collapse collapse justify-content-center" id="navbarDefault">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/main">Streams</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/profile">Profile</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!--/ Nav End /-->

    <main class="app">
        <div class="header">
            <h2>Upload Images or videos
                <div class="server-message"></div>
            </h2>
        </div>

        <div class="input-div">
            <p>Drag & Drop videos <span class="browse">Browse</span></p>
            <input type="file" class="file" accept="video/*">
        </div>

        <form id="saved-form">
            <div class="header">
                <h3>Saved in server</h3>
                <button type="submit">Delete</button>
            </div>
            <div class="saved-div" id="saved-div"></div>
        </form>

        <form id="queued-form">
            <div class="header">
                <h3>Queued in frontend</h3>
                <button type="submit">Upload</button>
            </div>
            <div class="queued-div" id="queued-div"></div>
        </form>
    </main>

    <!-- JavaScript Libraries -->
    <script src="../../main_css/nav_bar_css/lib/jquery/jquery.min.js"></script>
    <script src="../../main_css/nav_bar_css/lib/jquery/jquery-migrate.min.js"></script>
    <script src="../../main_css/nav_bar_css/lib/popper/popper.min.js"></script>
    <script src="../../main_css/nav_bar_css/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../main_css/nav_bar_css/lib/easing/easing.min.js"></script>
    <script src="../../main_css/nav_bar_css/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="../../main_css/nav_bar_css/lib/scrollreveal/scrollreveal.min.js"></script>
    <!-- Contact Form JavaScript File -->
    <script src="../../main_css/nav_bar_css/contactform/contactform.js"></script>

    <!-- Template Main Javascript File -->
    <script src="../../main_css/nav_bar_css/js/main.js"></script>
    <script src="../upload_vid_files/upload.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const videoList = document.getElementById('saved-div');
        const errorMessage = document.querySelector('.server-message');
        // Fetch the list of videos from the server
        fetch('/api/videos')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(videos => {
                if (videos.length === 0) {
                    errorMessage.textContent = 'No videos found in the uploads directory.';
                    return;
                }
                videos.forEach(video => {
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-container video';

                    const videoElement = document.createElement('video');
                    videoElement.controls = true;
                    videoElement.width = 200;

                    const source = document.createElement('source');
                    source.src = `/upload_vid_files/uploads/${video}`;
                    source.type = 'video/mp4';

                    const button = document.createElement('button');
                    button.className = 'delete-button';
                    button.innerHTML = '&times;'; // Add a delete symbol
                    button.onclick = () => deleteSavedVideo(video); // Pass the video filename to the delete function

                    videoElement.appendChild(source);
                    videoContainer.appendChild(videoElement);
                    videoContainer.appendChild(button);
                    videoList.appendChild(videoContainer);
                });
            })
            .catch(error => {
                console.error('Error:', error);
                errorMessage.textContent = `Error loading videos: ${error.message}`;
            });
        
    });
    function deleteSavedVideo(video) {
        fetch(`/videos/${video}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            location.reload(); // Reload the page to update the list
        })
        .catch(error => {
            console.error('Error deleting video:', error);
            errorMessage.textContent = `Error deleting video: ${error.message}`;
        });
    }
    </script>
</body>

</html>
